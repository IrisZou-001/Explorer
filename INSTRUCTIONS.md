# 智能体探索者软件使用说明

## 软件简介
这是一个基于Python的交互式智能体探索软件，具有图形用户界面(GUI)，支持用户与智能体进行对话，并实时显示探索地图。

## 功能特点
1. 左侧三分之二区域为对话界面，支持聊天气泡显示
2. 右侧区域为探索地图，可根据智能体返回的信息动态更新
3. 支持智能体API调用，实现用户输入与智能体响应交互
4. 采用面向对象的设计方式，便于维护和扩展
5. 添加了模拟模式功能，可在无网络或API不可用时使用
6. 完善的错误处理机制，提供友好的错误提示
7. 包含菜单栏和状态栏，提供更多操作选项
8. 启动时显示欢迎信息和使用提示

## 环境要求
- Python 3.6+ 
- 依赖库：
  - tkinter (Python标准库)
  - Pillow (PIL)
  - numpy
  
## 安装依赖
```bash
pip install Pillow numpy
```

## 使用方法
1. 确保已安装所有必要的依赖库
2. API配置已自动从readme.md中加载，如需修改可在`_initialize_api_config`方法中调整
3. 运行主程序：
```bash
python interactive_explorer.py
```
4. 在左侧聊天输入框中输入消息，点击"发送"按钮或按Enter键
5. 观察智能体响应，并查看右侧地图的更新
6. 在"选项"菜单中可以启用/禁用模拟模式，用于测试

### 模拟模式使用
当启用模拟模式时，程序会使用内置的模拟响应，无需实际调用API：
1. 通过"选项"菜单启用"模拟模式"
2. 状态栏会显示"就绪（模拟模式）"提示
3. 输入相关指令（如"探索房间1"、"房间4"等）测试功能

### 示例指令
- 探索房间1
- 房间4有什么
- 我想看看房间6

## 主要类与方法说明

### InteractiveExplorer类
这是软件的主要类，封装了所有功能。

#### 初始化方法
```python
def __init__(self, root)
```
- **参数**: `root` - Tkinter根窗口对象
- **功能**: 初始化应用程序，创建UI，设置迷宫和API配置

#### UI相关方法

1. `_create_ui()`
   - **功能**: 创建用户界面，包括聊天区域和地图区域
   - **调用方式**: 内部初始化时自动调用

2. `_add_message_to_display(sender, message)`
   - **参数**: 
     - `sender` - 发送者名称（"用户"或"智能体"）
     - `message` - 消息内容
   - **功能**: 将消息添加到聊天显示区域，并设置不同的聊天气泡样式

#### 地图相关方法

1. `_update_map()`
   - **功能**: 更新地图显示
   - **调用方式**: 当房间信息更新时自动调用

2. `_generate_maze_image(current_room)`
   - **参数**: `current_room` - 当前房间号
   - **功能**: 根据当前房间生成迷宫图像
   - **返回值**: PIL.Image对象

3. `_update_room_from_response(response)`
   - **参数**: `response` - 智能体响应文本
   - **功能**: 从智能体响应中提取房间信息并更新地图

4. `_update_visited_matrix()`
   - **功能**: 更新访问路径矩阵，记录探索过的房间和路径

#### API调用方法

1. `_send_message()`
   - **功能**: 发送用户消息并调用智能体API
   - **调用方式**: 点击发送按钮或按Enter键时触发

2. `_call_agent_api(user_input)`
   - **参数**: `user_input` - 用户输入文本
   - **功能**: 调用智能体API并处理响应
   - **调用方式**: 在单独线程中异步调用
   - **处理流程**: 首先检查模拟模式状态，然后构建请求数据，创建连接，获取并处理响应

3. `_parse_api_response(raw_response)`
   - **参数**: `raw_response` - 原始API响应文本
   - **功能**: 解析API响应，提取有用信息
   - **返回值**: 解析后的响应内容

4. `_handle_mock_response(user_input)`
   - **参数**: `user_input` - 用户输入文本
   - **功能**: 处理模拟响应，用于测试
   - **调用方式**: 当启用模拟模式或API调用失败时调用

#### 工具方法

1. `_get_default_chinese_font(size)`
   - **参数**: `size` - 字体大小
   - **功能**: 获取系统默认中文字体
   - **返回值**: 字体元组 (字体名称, 大小)

2. `_pil_get_default_chinese_font(size)`
   - **参数**: `size` - 字体大小
   - **功能**: 获取PIL可用的中文字体
   - **返回值**: ImageFont对象

## 配置说明

### API配置
程序已自动从readme.md中加载API配置信息，包括：
- `self.api_key` - API密钥
- `self.api_secret` - API密码
- `self.flow_id` - 工作流ID
- `self.headers` - 请求头，包含Content-Type、Accept和Authorization
- `self.api_url` - API服务器地址
- `self.api_endpoint` - API端点路径
- `self.uid` - 用户ID
- `self.mock_mode` - 模拟模式开关，默认为False

**注意**: 如果需要更新API配置，可直接修改`_initialize_api_config`方法中的相关参数。

### 迷宫配置
迷宫的结构定义在`_initialize_maze_config`方法中，包括：
- 房间大小、墙厚度等尺寸参数
- 颜色配置
- 房间结构数据（房间号、子房间、物品等）

## 扩展建议
1. **添加登录系统**：实现用户认证功能
2. **优化地图显示**：添加更丰富的视觉效果和交互功能
3. **支持更多API**：接入多个不同的智能体API
4. **保存聊天历史**：实现聊天记录的本地存储和加载
5. **添加主题切换**：支持多种界面主题

## 故障排除

### 常见问题
1. **API调用失败**：
   - 检查网络连接
   - 确认API密钥是否正确
   - 查看防火墙设置
   - 尝试启用模拟模式继续使用

2. **地图无法正常显示**：
   - 确认已安装Pillow库
   - 检查系统是否有可用的中文字体
   - 尝试调整窗口大小触发地图更新

3. **界面卡顿**：
   - 减少消息数量
   - 确保API调用在单独线程中执行

4. **libpng警告**：
   - 这些警告通常不会影响程序功能，可以忽略
   - 它们与图像的色彩配置文件有关

5. **聊天气泡样式问题**：
   - 由于Tkinter版本差异，某些样式特性可能不可用
   - 程序已适配不同版本的Tkinter

## 示例

### 输入输出示例

**示例1：使用模拟模式**
1. 通过"选项"菜单启用"模拟模式"
2. 用户输入：
```
探索房间1
```
3. 智能体[模拟]响应：
```
你现在位于房间1，这里有高原盐湖晶石。你可以前往房间4继续探索。
```
4. 地图会自动更新，显示当前位于房间1的探索状态

**示例2：探索更多房间**
1. 用户输入：
```
房间4
```
2. 智能体[模拟]响应：
```
房间4里有牦牛奶酪。从这里你可以前往房间2、房间5或房间7。
```
3. 地图会更新，显示房间4的探索状态

**示例3：查找通关道具**
1. 用户输入：
```
房间7
```
2. 智能体[模拟]响应：
```
房间7里有银饰扣件。你可以前往房间6。
```
3. 用户输入：
```
房间6
```
4. 智能体[模拟]响应：
```
房间6里有松石玉石。恭喜你找到了通关道具！
```
5. 地图会显示完整的探索路径